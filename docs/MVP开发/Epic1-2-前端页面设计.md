# Epic1/2 前端页面设计

本文档规划 Epic 1（核心系统与用户认证）与 Epic 2（组织与人员管理）的 H5 Web 端前端页面原型与交互规范，统一使用 TDesign Uni (tdesign-uni) 作为视觉设计系统与组件库，以便快速产出一致体验。

> 说明：MVP 阶段优先交付 H5（uni-app + tdesign-uni，仅支持 Vue3）。后续如需小程序/多端能力，可直接复用同一代码 + 平台差异适配；不再引用 TDesign Vue Next / tdesign-mobile-vue。

---

## 1. 目标与范围

- 目标：
  - 用最短路径完成“认证 + 组织与人员管理”端到端闭环。
  - 输出可直接落地的页面结构、组件选型与交互细节，降低实现沟通成本。
- 范围：
  - Epic 1：登录/登出、路由守卫、基础布局与导航、个人中心概览。
  - Epic 2：部门/职位/成员/任期的列表、创建/编辑、详情预览与批量操作（可部分延后）。

---

## 2. 设计系统与主题

- 组件库：TDesign Uni（tdesign-uni）—— 针对 uni-app 的 TDesign 适配实现，只支持 Vue3；以移动端/H5 为主，不强依赖 PC 式复杂布局组件。
- 主题与品牌：
  - 品牌色：建议通过全局 CSS 变量（如 `--td-brand-color: #2A82E4`）或定制入口覆盖；必要时在 `uni.scss` 里维护扩展变量。
  - 暗黑模式：当前版本暂不强制；若后续需要，可在 `<page>` 根节点添加主题 class 并切换变量集。
- 全局交互（结合 tdesign-uni 提供能力 & 适度降级策略）：
  - 反馈：轻提示与操作结果使用 `Message` / `Toast`（若组件库仅暴露 Toast，则统一 Toast），重要或持久信息用 `Dialog` 弹窗确认；暂不使用 PC 端 Notification 悬浮卡片，需长提示时可用自定义顶部条替代。
  - 表单：使用 `Form` + 基础输入组件（Input / Picker / Radio / Checkbox / Switch / Upload 等）与本地校验逻辑；提交中用按钮 `loading` 属性；字段布局以垂直（默认）+ 自定义格栅/Flex 辅助。
  - 列表：优先 `List` / 自定义 `Cell` 组合；如需表格形式，先用简化“卡片列表 + 头部筛选”模式；复杂列宽拖拽/列配置延后，分页由后端接口 + 本地分页器组件（若库无分页器则自定义 Pagination 条）。
  - 日期：使用日期/时间选择相关组件（若缺失区间选择组件：通过两个日期选择控件实现 start/end）；统一校验开始 ≤ 结束。
  - 上传：`Upload`（头像/附件）；前置校验文件大小/类型；异常在 Toast 中提示。
  - 图标：沿用 TDesign Icon 集；业务特定图标不足时用本地图标或自定义 SVG。

---

## 3. 信息架构（IA）与路由

- 顶层导航（侧边栏）：

  - 仪表盘（Dashboard）
  - 组织管理
    - 部门管理
    - 职务管理
    - 成员管理
    - 任期分配
  - 个人中心
- 顶部栏：面包屑、搜索（可选）、全局通知、用户头像/菜单（登出、主题、个人中心）。
- 路由建议（uni-app H5，通过 `pages.json` 配置；此处为示意路径）：

  - `/pages/login/index` 登录
  - `/pages/dashboard/index` 仪表盘
  - `/pages/departments/index` 部门管理
  - `/pages/positions/index` 职务管理
  - `/pages/members/index` 成员管理
  - `/pages/assignments/index` 任期分配
  - `/pages/profile/index` 个人中心
- 路由守卫：

  - 未登录：重定向至 `/pages/login/index`。
  - 已登录但无权限：显示 403 结果页（`t-result`），提供返回首页按钮。

---

## 4. 公共布局与基础组件

- 布局骨架（移动/H5 优先）：
  - 顶部栏：自定义 `Header`（使用 Flex + 图标 + 标题 + 可选操作）；如后续引入统一导航，可封装 `AppHeader`。
  - 侧边栏（可选）：H5 首期不常驻；管理入口通过仪表盘快捷卡片或 TabBar / 菜单抽屉触达。后续若需要宽屏适配，可扩展响应式侧栏。
  - 主体：滚动容器，内含“标题区 + 筛选区 + 内容区”。面包屑在移动端可简化为“返回箭头 + 当前标题”。
  - 导航：底部 `TabBar`（首页/个人中心），业务页面用 `navigateTo` 进入；如需分组菜单，可添加抽屉式侧滑菜单。
- 通用组件（按 tdesign-uni 能力映射）：
  - 页面标题区：标题 + 操作按钮（使用 Button）。副标题直接用次级文案文本；工具按钮放右侧。
  - 查询区：`Form` + 折叠（使用自定义折叠容器/Collapse 组件，如库暂缺，使用显隐控制）。含重置/查询按钮。
  - 数据展示：优先 `List` / `Cell` / 卡片。若后续引入表格组件，则再升级；空态使用 `Empty`。
  - 详情/编辑：`Drawer` 或底部 `Popup`（若库 Drawer 不支持移动宽度，可使用全屏弹层模拟）。
  - 确认：`Dialog` 用于删除 / 风险操作二次确认。
  - Tag/状态：使用 `Tag` 组件区分状态（颜色语义保持后述约定）。

---

## 5. 页面原型（Epic 1）

### 5.1 登录页（/pages/login/index）

- 目标：账号/密码登录，获取 JWT 并保存（Pinia/本地存储）。
- 结构：居中卡片容器（自定义卡片样式或使用支持的 `Card` 组件） + `Form`。
- 表单字段：
  - 账号（`username`）：`t-input`，必填。
  - 密码（`password`）：`t-input type="password"`，必填。
  - 记住我（可选）：`t-checkbox`（仅 H5）。
- 操作：
  - 登录：`t-button theme="primary" block`，提交校验，loading 态。
- 反馈：
  - 成功：跳转 Dashboard，并 `t-message.success("登录成功")`。
  - 失败：解析错误码，`t-message.error("用户名或密码错误")`。
- 状态与异常：
  - 登录中禁用按钮与输入；401 全局拦截提示后重定向登录。
- 接口：`POST /api/v1/login`（参考后端登录接口；若尚未定义，需统一）。

### 5.2 仪表盘（/pages/dashboard/index）

- 目标：快速入口与概览数据。
- 模块：
  - 快捷入口：多列自适应“卡片按钮”栅格（自定义 Grid + Card）。
  - 待办（如后续引入审批/通知）占位 `t-list`。
  - 最近操作/最近创建成员 `t-table`（简版）。
- 说明：MVP 可先放置占位组件 + 引导文案，后续迭代接入真实数据。

### 5.3 个人中心（/pages/profile/index）

- 目标：展示当前登录用户信息，支持密码修改（跳转二级页或弹窗）。
- 模块：
  - 用户信息：头像（`Upload` + 头像展示）、姓名、角色、邮箱。
  - 安全设置：修改密码按钮 -> `Dialog` + `Form`（原密码/新密码/确认新密码）。
- 接口：
  - `GET /api/v1/users/me`（拉取个人信息）。
  - `PUT /api/v1/users/me/password`（修改密码）。

---

## 6. 页面原型（Epic 2）

### 6.1 部门管理（/pages/departments/index）

- 目标：增删改查部门，支持树结构与排序（排序可延后）。
- 布局：
  - 左侧：部门树（若无现成 Tree 组件，阶段一可用缩进列表 + 展开箭头模拟；后续替换 Tree）。
  - 右侧：详情卡 + 子部门列表（使用 List / 自定义表格样式）。
- 交互：
  - 新增部门：顶部按钮（`Button`） -> `Drawer` 表单。
  - 编辑：详情卡或列表行操作 -> `Drawer`。
  - 删除：`Dialog` 二次确认（需后端校验子部门/成员）。
- 表单字段：
  - 名称 `name`（必填）、描述 `description`、上级部门 `parent_id`（`t-tree-select`）。
- 权限：
  - 浏览：登录用户可见。
  - 新增/编辑/删除：仅 `admin` 显示操作按钮。
- 接口：
  - `GET /api/v1/departments` 列表/树。
  - `POST/PUT/DELETE /api/v1/departments` 变更。

### 6.2 职务管理（/pages/positions/index）

- 目标：维护职位信息。
- 结构：
  - 查询区：关键字、访问级别区间（上下限两个输入/选择器）。
  - 列表：卡片或简易“伪表格”行（名称、访问级别、时间、操作按钮）。
- 交互：
  - 新增/编辑：`Drawer` 表单。
  - 删除：`Dialog` 确认。
- 表单字段：
  - 名称 `name`（必填）、访问级别 `access_level`（数字，必填）、描述（可选）。
- 权限：
  - 浏览：登录用户可见。
  - 新增/编辑/删除：仅 `admin`。
- 接口：
  - `GET /api/v1/positions`
  - `POST/PUT/DELETE /api/v1/positions`

### 6.3 成员管理（/pages/members/index）

- 目标：成员档案的列表、创建、编辑、导出（导出可延后）。
- 结构：
  - 查询区：
    - 关键字（姓名/学号/电话/邮箱）
  - 成员状态（在读/已毕业/休学/退会）`Select`
    - 年级 `grade`、学院 `college`、专业 `major`
  - 部门 `department`（若无 TreeSelect：使用先选父级后选子级的级联选择或弹层树模拟）
  - 列表：卡片/行列表（含关键字段 + 操作区）。
    - 列：头像、姓名、学号、年级、学院/专业、状态、加入时间、当前部门/职务、操作。
  - 操作区：新增成员、批量导入（后续）、导出（后续）。
- 交互：
  - 查看详情：行点击/按钮 -> `Drawer` 展示 + 任期时间线（时间线若暂缺组件，先用垂直列表按时间排序替代）。
  - 新增/编辑：`Drawer` 表单（支持创建关联 `User`）。
  - 删除：`Dialog` 确认（阻止在任成员删除）。
- 表单字段（核心）：
  - 姓名、学号、年级、学院、专业、电话、邮箱、入会时间、预计毕业时间、状态、头像上传、技能标签（后续）、备注。
- 权限：
  - 浏览：登录用户可见。
  - 新增/编辑/删除：仅 `admin`。
- 接口：
  - `GET /api/v1/members`
  - `POST/PUT/DELETE /api/v1/members`

### 6.4 任期分配（/pages/assignments/index）

- 目标：为成员在特定部门/队伍分配职务与起止时间；查看历史记录。
- 结构：
  - 查询区：成员、部门（树或级联）、职务、是否在任（EndDate 为空）。
  - 列表：行列表（成员、部门、职务、起止时间、状态/操作）。
    - 列：成员、部门/队伍、职务、开始日期、结束日期（为空显示“在任”标记）、操作。
  - 操作区：新增任期。
- 交互：
  - 新增/编辑：`Drawer` 表单；成员（`Select` 支持搜索）、部门（树/级联）、职务（`Select`）、开始/结束日期（两个日期选择）。
  - 删除：`Dialog` 确认（提示权限影响）。
- 权限：
  - 浏览：登录用户可见。
  - 新增/编辑/删除：仅 `admin`。
- 接口：
  - `GET /api/v1/assignments`
  - `POST/PUT/DELETE /api/v1/assignments`

---

## 7. 表单与校验规范

- 必填项显示星号；错误提示在项下方展示，提交时滚动到首个错误项。
- 通用校验：
  - 手机号：`/^1\d{10}$/`（可根据学校规范调整）。
  - 邮箱：标准邮箱格式校验。
  - 学号：长度与字符集校验（按校内规范）。
  - 日期：开始日期不得晚于结束日期。
- 提交行为：
  - 提交前禁用按钮，显示 loading；成功关闭抽屉并刷新列表；失败保留表单并提示。

---

## 8. 表格、筛选与状态规范

- 表格：
  - 行操作区域统一使用内联 `Button` / 图标按钮；间距用 `Space`（若缺失则通过样式 margin）。
  - 空态使用 `Empty`，提供“新增”按钮。
- 筛选：
  - 查询区支持折叠/展开；支持“重置”和“查询”。
  - 长列表筛选建议服务端执行；分页尺寸可选 10/20/50。
- 状态标识：
  - 成员状态：`Tag`（primary=在读、success=已毕业、warning=休学、danger=退会）。
  - 任期状态：结束日期为空显示 `Tag`（“在任”）。

---

## 9. 权限与可见性

- 角色：`admin` 与 `member`（MVP）。
- 可见性：
  - 列表与详情：登录可见。
  - 写操作按钮：仅 `admin` 渲染或启用；后端同时二次校验。
- 路由守卫：在 `onLaunch` 或路由拦截中检查 Token；401 清理态并跳转登录。

---

## 10. 接口映射与数据约定（与后端对齐）

- 统一约定：
  - 所有受保护接口在 `Authorization: Bearer <token>` 下访问。
  - 统一响应结构参考 `internal/dto/response_dto.go`（例如包含 `code`、`message`、`data`）。
- 主要资源：
  - Departments：`GET/POST/PUT/DELETE /api/v1/departments`
  - Positions：`GET/POST/PUT/DELETE /api/v1/positions`
  - Members：`GET/POST/PUT/DELETE /api/v1/members`
  - Assignments：`GET/POST/PUT/DELETE /api/v1/assignments`
  - Auth：`POST /api/v1/login`（如未定义，需与后端统一）

---

## 11. 加载/错误/空态与反馈

- 加载：页面骨架优先使用占位块/自定义 skeleton（若组件库提供 Skeleton 则直接使用）；按钮 `loading` 显示请求中。
- 错误：
  - 401：清理登录态并重定向登录（Toast：“登录已过期”）。
  - 403：显示禁止访问结果（可自定义 Result 视图/占位插画）。
  - 5xx：Toast 或 Dialog（严重）提示“服务繁忙，请稍后重试”。
- 空态：`Empty` + 行动按钮（“新增成员”）。

---

## 12. 移动端适配（H5）

- 列表：默认精简字段；扩展详情通过 Drawer / 详情页查看；列设置功能延后。
- 抽屉：移动端宽度占满（100%）；次要编辑可下沉为底部弹层。
- 查询区：默认折叠，仅展示 1~2 个高频筛选；展开查看更多。

---

## 13. 实现清单（MVP Sprint）

- 公共：
  - 顶部/底部导航（Header/TabBar）与主题变量；请求封装（JWT 注入，401/403 统一处理，Toast 提示）。
  - 路由守卫：`uni.addInterceptor` 检查 Token；403 结果占位组件。
- 页面：
  - 登录、仪表盘、个人中心。
  - 部门管理：树（或缩进列表）+ 子列表 + 抽屉表单。
  - 职务管理：列表 + 抽屉表单。
  - 成员管理：查询区 + 列表 + 详情 Drawer + 表单。
  - 任期分配：查询区 + 列表 + 表单。

---

## 14. 风险与备选方案

- 组件库适配：使用 tdesign-uni（H5/小程序复用）；暂不依赖 PC 端特性，避免迁移成本。
- 权限细粒度：当前以角色级（admin/member）为主；后续升级至“权限点”后，前端按钮显隐需绑定细粒度权限。
- 数据一致性与约束：删除成员/部门时需校验关联（任期/子部门/用户），前端需基于接口返回做明确提示与拦截。

---

## 15. 附：页面简要线框（文字稿）

- 成员管理列表：
  - 顶部：标题“成员管理” + [新增成员]
  - 查询区（可折叠）：关键字 | 状态 | 年级 | 部门 | [重置] [查询]
  - 表格：头像 | 姓名 | 学号 | 年级 | 学院/专业 | 状态 | 加入时间 | 当前部门/职务 | 操作（查看/编辑/删除）
  - 抽屉（查看/编辑）：基础信息 | 任期时间线 | 操作区（保存/取消）
- 任期分配列表：
  - 顶部：标题“任期分配” + [新增任期]
  - 查询区：成员 | 部门 | 职务 | 是否在任 | [重置] [查询]
  - 表格：成员 | 部门/队伍 | 职务 | 开始日期 | 结束日期（在任） | 操作（编辑/删除）
